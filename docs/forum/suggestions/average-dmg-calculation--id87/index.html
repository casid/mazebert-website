

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="nofollow">
        <meta name="language" content="en">
        <title>average Dmg calculation</title>
        <link rel="stylesheet" href="https://mazebert.com/assets/css/mazebert.css?t=1690563617">
        <script src="https://mazebert.com/assets/js/jquery.min.js?t=1690563617"></script>
    </head>

    <body>
        <header>
            <nav class="navigation">
                <a class="nav-brand" href="https://mazebert.com/">
                    <img srcset="https://mazebert.com/assets/images/app-icon.png?t=1690563617, https://mazebert.com/assets/images/app-icon-2x.png?t=1690563617 2x" src="https://mazebert.com/assets/images/app-icon-2x.png?t=1690563617" class="app-icon" alt="Mazebert TD - Play your cards wisely to survive">
                </a>
                <div class="nav-mobile">
                    <div id="nav-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <span class="forum-badge badge"></span>
                </div>
                <div class="nav-menu">
                    <a href="https://mazebert.com/news/" class="nav-item">News</a>
                    <a href="https://mazebert.com/stats/" class="nav-item">Stats</a>
                    <a href="https://mazebert.com/cards/" class="nav-item">Cards</a>
                    <a href="https://mazebert.com/forum/" class="nav-item is-active">Forum<span class="forum-badge badge"></span></a>
                    <a href="https://mazebert.com/ladder/" class="nav-item">Ladder</a>
                    <a href="https://mazebert.com/credits/" class="nav-item">Credits</a>
                    <a href="https://mazebert.com/reviews/" class="nav-item">Reviews</a>
                </div>
            </nav>
        </header>

        <main class="has-navbar-fixed-top">
            <div class="container">
                <nav class="breadcrumbs">
                    <a href="https://mazebert.com/forum/">Forum</a>&nbsp;/
                    <a href="https://mazebert.com/forum/suggestions/">Suggestions</a>&nbsp;/
                    <span>average Dmg calculation</span>
                </nav>
            </div>
            

    <div class="container">
        
<div class="post-content">
    <div class="post-author first">
        <div class="profile-picture">
            <img class="shadow" alt="DerpMinh" src="https://secure.gravatar.com/avatar/6e82eddcfb2b69040c0c17200a0c92bc?s=160&amp;d=retro&amp;r=g" height="80" width="80">
        </div>
        <div class="profile-content">
            <h4><a href="https://mazebert.com/player/1332/">DerpMinh</a></h4>
            <h5 class="subtitle">
                Level:&nbsp;77<br>
                Rank:&nbsp;2432<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1392059147">
        </div>
    </div>

    <h1>average Dmg calculation</h1>
    <a id="87"></a>

    <span class="post-content-text">So i lately noticed that my muli with &gt;100% crit chance was dealing less dmg(crits popping up) than the "average" dmg stated in the "character sheet" (or what itÂ´s called).
I think that it`s due to the lack of capping crit chance to 100% 
Also at 100% you should always expect maximum multicrit or are the "rerolls" for multicrits affected by a penalty ( like minus x% for each crit already done)</span>

    <button data-playerid="1332" data-postid="87" class="edit-post-button">Edit</button>
</div>
<hr/>

        
<div class="post-content">
    <div class="post-author">
        <div class="profile-picture">
            <img class="shadow" alt="Doomsnail" src="https://secure.gravatar.com/avatar/e3670f95a3c988e799bdeef7f97a2bf7?s=160&amp;d=retro&amp;r=g" height="80" width="80">
        </div>
        <div class="profile-content">
            <h4>Doomsnail</h4>
            <h5 class="subtitle">
                Level:&nbsp;-<br>
                Rank:&nbsp;-<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1393188565">
        </div>
    </div>

    <a id="1267"></a>

    <span class="post-content-text">This bug appears to be accurate. I have a Biofield Laser Satellite. 

With a Rare T-Bone Steak, stats are:

Damage Add: +858.6%
Crit Damage: +1150.5%
Crit Chance: +192.7%
Multicrit: +7
Average Damage: 78.8M

With Meat Mallet, stats are:

Damage Add: +1028.6%
Crit Damage: +1150.5%
Crit Chance: +132.7%
Multicrit: +7
Average Damage: 64.3M

Of course, this does not make sense. Not unless having a Crit Chance higher than 100% somehow contributes to damage, which is the second point that DerpMinh is raising.

Does 200% Crit Chance guarantee 2 crits, with respectfully higher chances of +3, +4, etc. crits?
Same for 300%, except with 3 crits?

Please explain!</span>

    <button data-playerid="0" data-postid="1267" class="edit-post-button">Edit</button>
</div>
<hr/>

        
<div class="post-content">
    <div class="post-author">
        <div class="profile-picture">
            <img class="shadow" alt="Andy" src="https://secure.gravatar.com/avatar/5bf536d27c50cc30a6945c1d63f48535?s=160&amp;d=retro&amp;r=g" height="80" width="80">
            <div class="badge-wrapper">
                <span class="level">43</span>
                <img alt="Supporter Level 43" src="https://mazebert.com/assets/images/supporter-level-bg.png?t=1690563617" srcset="https://mazebert.com/assets/images/supporter-level-bg@2x.png?t=1690563617 2x">
            </div>
        </div>
        <div class="profile-content">
            <h4><a href="https://mazebert.com/player/115/">Andy</a></h4>
            <h5 class="subtitle">
                Level:&nbsp;109<br>
                Rank:&nbsp;323<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1393189620">
        </div>
        <a href="https://mazebert.com/supporters/rag-nar-rog-supporter-pack/">
            <img alt="Rag nar Rog Supporter" style="float: right;" src="https://mazebert.com/assets/images/rnr-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/rnr-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
        <a href="https://mazebert.com/supporters/rise-of-cthulhu-supporter-pack/">
            <img alt="Rise of Cthulhu Supporter" style="float: right;" src="https://mazebert.com/assets/images/roc-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/roc-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
        <a href="https://mazebert.com/supporters/dawn-of-light-supporter-pack/">
            <img alt="Dawn of Light Supporter" style="float: right;" src="https://mazebert.com/assets/images/dol-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/dol-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
    </div>

    <a id="1269"></a>

    <span class="post-content-text">Hi @Doomsnail, welcome on board!

@DerpMinh sorry your question got somehow lost on my radar..

Dang, the wordpress code plugin doesn't work in the forum. As this is a question that was asked a few times now (and it is not clear how this calculation is done), I will sum it up in a blog post!

Just a sec...</span>

    <button data-playerid="115" data-postid="1269" class="edit-post-button">Edit</button>
</div>
<hr/>

        
<div class="post-content">
    <div class="post-author">
        <div class="profile-picture">
            <img class="shadow" alt="Doomsnail" src="https://secure.gravatar.com/avatar/e3670f95a3c988e799bdeef7f97a2bf7?s=160&amp;d=retro&amp;r=g" height="80" width="80">
        </div>
        <div class="profile-content">
            <h4>Doomsnail</h4>
            <h5 class="subtitle">
                Level:&nbsp;-<br>
                Rank:&nbsp;-<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1393190022">
        </div>
    </div>

    <a id="1270"></a>

    <span class="post-content-text">WOW that is super awesome! I've never seen a dev release the actual formula. 

So, it looks like a higher crit chance increases the probability of compounding crits (up to the multicrit number). Am I drawing the correct conclusion, or am I way off?

Gotta say I am impressed by your forum interaction, Andy.</span>

    <button data-playerid="0" data-postid="1270" class="edit-post-button">Edit</button>
</div>
<hr/>

        
<div class="post-content">
    <div class="post-author">
        <div class="profile-picture">
            <img class="shadow" alt="Andy" src="https://secure.gravatar.com/avatar/5bf536d27c50cc30a6945c1d63f48535?s=160&amp;d=retro&amp;r=g" height="80" width="80">
            <div class="badge-wrapper">
                <span class="level">43</span>
                <img alt="Supporter Level 43" src="https://mazebert.com/assets/images/supporter-level-bg.png?t=1690563617" srcset="https://mazebert.com/assets/images/supporter-level-bg@2x.png?t=1690563617 2x">
            </div>
        </div>
        <div class="profile-content">
            <h4><a href="https://mazebert.com/player/115/">Andy</a></h4>
            <h5 class="subtitle">
                Level:&nbsp;109<br>
                Rank:&nbsp;323<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1393190801">
        </div>
        <a href="https://mazebert.com/supporters/rag-nar-rog-supporter-pack/">
            <img alt="Rag nar Rog Supporter" style="float: right;" src="https://mazebert.com/assets/images/rnr-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/rnr-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
        <a href="https://mazebert.com/supporters/rise-of-cthulhu-supporter-pack/">
            <img alt="Rise of Cthulhu Supporter" style="float: right;" src="https://mazebert.com/assets/images/roc-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/roc-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
        <a href="https://mazebert.com/supporters/dawn-of-light-supporter-pack/">
            <img alt="Dawn of Light Supporter" style="float: right;" src="https://mazebert.com/assets/images/dol-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/dol-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
    </div>

    <a id="1271"></a>

    <span class="post-content-text">Yes, you are right! That's exactly how it works. Also, I converted my previous answer into a blog post, so that the code formatting is a bit nicer. <a href="https://mazebert.com/2014/02/23/multicrit/">Here it is</a>.</span>

    <button data-playerid="115" data-postid="1271" class="edit-post-button">Edit</button>
</div>
<hr/>

        
<div class="post-content">
    <div class="post-author">
        <div class="profile-picture">
            <img class="shadow" alt="Rahler" src="https://secure.gravatar.com/avatar/16459bdd9838f4bdddf0cf08c3b0de31?s=160&amp;d=retro&amp;r=g" height="80" width="80">
        </div>
        <div class="profile-content">
            <h4><a href="https://mazebert.com/player/19649/">Rahler</a></h4>
            <h5 class="subtitle">
                Level:&nbsp;56<br>
                Rank:&nbsp;8895<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1394047265">
        </div>
    </div>

    <a id="1296"></a>

    <span class="post-content-text">It would still be nice if the average damage calculation actually showed average damage. As it is, it seems to show numbers that are higher than possible when crit chance exceeds 100%.

IE: A tower with 1 multicrit and 200% crit chance, the average damage will be more than the maximum the tower can crit for. It's actually really common for your carry tower to have an average damage that's higher than it's highest recorded crit.</span>

    <button data-playerid="19649" data-postid="1296" class="edit-post-button">Edit</button>
</div>
<hr/>

        
<div class="post-content">
    <div class="post-author">
        <div class="profile-picture">
            <img class="shadow" alt="Andy" src="https://secure.gravatar.com/avatar/5bf536d27c50cc30a6945c1d63f48535?s=160&amp;d=retro&amp;r=g" height="80" width="80">
            <div class="badge-wrapper">
                <span class="level">43</span>
                <img alt="Supporter Level 43" src="https://mazebert.com/assets/images/supporter-level-bg.png?t=1690563617" srcset="https://mazebert.com/assets/images/supporter-level-bg@2x.png?t=1690563617 2x">
            </div>
        </div>
        <div class="profile-content">
            <h4><a href="https://mazebert.com/player/115/">Andy</a></h4>
            <h5 class="subtitle">
                Level:&nbsp;109<br>
                Rank:&nbsp;323<br/><br/>
            </h5>
        </div>
        <div class="profile-more-content post-created" data-ts="1394057628">
        </div>
        <a href="https://mazebert.com/supporters/rag-nar-rog-supporter-pack/">
            <img alt="Rag nar Rog Supporter" style="float: right;" src="https://mazebert.com/assets/images/rnr-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/rnr-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
        <a href="https://mazebert.com/supporters/rise-of-cthulhu-supporter-pack/">
            <img alt="Rise of Cthulhu Supporter" style="float: right;" src="https://mazebert.com/assets/images/roc-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/roc-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
        <a href="https://mazebert.com/supporters/dawn-of-light-supporter-pack/">
            <img alt="Dawn of Light Supporter" style="float: right;" src="https://mazebert.com/assets/images/dol-supporter-badge.png?t=1690563617" srcset="https://mazebert.com/assets/images/dol-supporter-badge@2x.png?t=1690563617 2x"/>
        </a><br>
    </div>

    <a id="1297"></a><a id="latest"></a>

    <span class="post-content-text">I just checked the code and you are completely right about it. There is a flaw in the average damage calculation.

For every possible multicrit I do right now:
damage += averageBaseDamage * _critDamage * critChance;

Which obviously only is correct if crit chance is within [0, 1]. I fixed this now:
damage += averageBaseDamage * _critDamage * Math.min(1.0, critChance);

Thanks for the hint :-)</span>

    <button data-playerid="115" data-postid="1297" class="edit-post-button">Edit</button>
</div>
<hr/>

    </div>

    <script>
    var formatTimeDelta = {
        ONE_MINUTE: 60,
        ONE_HOUR: 3600,
        ONE_DAY: 86400,
        ONE_MONTH: 2592000,
        ONE_YEAR: 31536000,

        formatTimeValueSuffix: function (value, unit, suffix) {
            value = Math.floor(value);
            if (value < 1 || value > 1) {
                unit += "s";
            }
            return value + " " + unit + suffix;
        },

        formatTimeValue: function (value, unit) {
            return this.formatTimeValueSuffix(value, unit, " ago");
        },

        formatYears: function (delta) {
            return this.formatTimeValue(delta / this.ONE_YEAR, "year");
        },

        formatMonths: function (delta) {
            return this.formatTimeValue(delta / this.ONE_MONTH, "month");
        },

        formatDays: function (delta) {
            return this.formatTimeValue(delta / this.ONE_DAY, "day");
        },

        formatHours: function (delta) {
            return this.formatTimeValue(delta / this.ONE_HOUR, "hour");
        },

        formatMinutes: function (delta) {
            return this.formatTimeValue(delta / this.ONE_MINUTE, "minute");
        },

        formatSeconds: function (delta) {
            return this.formatTimeValue(delta, "second");
        },

        formatDelta: function (delta) {
            if (delta <= 0) {
                return 'now';
            }

            if (delta < this.ONE_MINUTE) return this.formatSeconds(delta);
            if (delta < this.ONE_HOUR) return this.formatMinutes(delta);
            if (delta < this.ONE_DAY) return this.formatHours(delta);
            if (delta < this.ONE_MONTH) return this.formatDays(delta);
            if (delta < this.ONE_YEAR) return this.formatMonths(delta);
            return this.formatYears(delta);
        },

        formatDeltaVerbose: function(delta) {
            if (delta < 0) {
                delta = 0;
            }

            return this.formatTimeValueSuffix(delta / this.ONE_DAY, 'day', ', ') +
                   this.formatTimeValueSuffix((delta % this.ONE_DAY) / this.ONE_HOUR, 'hour', ', ') +
                   this.formatTimeValueSuffix((delta % this.ONE_HOUR) / this.ONE_MINUTE, 'minute', ', ') +
                   this.formatTimeValueSuffix(Math.floor(delta) % this.ONE_MINUTE, 'second', '');
        },

        formatElement: function($element) {
            var delta = (Date.now() / 1000) - $element.data('ts');
            $element.html(this.formatDelta(delta));

            return delta;
        },

        format: function($selector) {
            var that = this;
            var elementsToRefresh = [];

            $selector.each(function() {
                var delta = that.formatElement($(this));

                if (delta < that.ONE_HOUR) {
                    elementsToRefresh[elementsToRefresh.length] = $(this);
                }
            });

            if (elementsToRefresh.length > 0) {
                setInterval(function(){
                    for (var i = 0; i < elementsToRefresh.length; ++i) {
                        that.formatElement(elementsToRefresh[i]);
                    }
                }, 1000);
            }
        },
    }
</script>
    <script>
        $(document).ready(function() {
            formatTimeDelta.format($('.post-created'));
        });
    </script>

            <div id="card-preview" style="position: absolute; display: none; top: 0; left: 0;">
    <img src="" srcset="" alt="Preview" />
</div>

<script>
$(document).ready(function() {
    var CardInfo = function() {
        this.id = 0;
        this.type = null;
    };

    var CardPreview = function() {

        this.calculateCardTypePrefix = function(type) {
            if (type === 'hero') return 'heroes/golden/Hero';
            if (type === 'tower') return 'towers/golden/Tower';
            if (type === 'item') return 'items/golden/Item';
            if (type === 'potion') return 'potions/golden/Potion';
            return '';
        };

        this.calculateImagePath = function(cardInfo) {
            var path = 'https://mazebert.com/wp-content/themes/twentytwelve/images/';
            path += this.calculateCardTypePrefix(cardInfo.type);
            path += '-' + cardInfo.id + '-card-preview.png';

            return path;
        };

        this.calculateImagePath2x = function(cardInfo) {
            var path = 'https://mazebert.com/wp-content/themes/twentytwelve/images/';
            path += this.calculateCardTypePrefix(cardInfo.type);
            path += '-' + cardInfo.id + '-card.png';

            return path;
        };

        this.show = function(cardInfo) {
            var image = $('#card-preview img');
            image.attr('src', this.calculateImagePath(cardInfo));
            image.attr('srcset', this.calculateImagePath2x(cardInfo) + " 2x");
            $('#card-preview').show();
        };

        this.hide = function() {
            $('#card-preview').hide();
        };

        this.update = function(x, y) {
            var offsetX = 60;
            if (x > $(document).width() / 2) {
                offsetX = -320 - 30;
            }
            $('#card-preview').css('left', x + offsetX).css('top', y - 212);
        };
    };

    var CardInfoParser = function() {

        this.parseCssInfo = function(cssClass, classPrefix, defaultValue) {
            if (cssClass.indexOf(classPrefix) === 0) {
                return cssClass.substr(classPrefix.length);
            } else {
                return defaultValue;
            }
        };

        this.parseCardInfo = function(classes) {
            var cardInfo = new CardInfo();
            classes = classes.split(' ');

            for (var i = 0, length = classes.length; i < length; ++i) {
                cardInfo.id = this.parseCssInfo(classes[i], 'card-id-', cardInfo.id);
                cardInfo.type = this.parseCssInfo(classes[i], 'card-type-', cardInfo.type);
            }

            return cardInfo;
        };
    };

    var cardPreview = new CardPreview();
    var cardInfoParser = new CardInfoParser();

    $('span.card-info').mouseenter(function() {
        var classes = $(this).attr('class');
        cardPreview.show(cardInfoParser.parseCardInfo(classes));
    }).mouseleave(function() {
        cardPreview.hide();
    }).mousemove(function(event) {
        var relX = event.pageX;
        var relY = event.pageY;

        cardPreview.update(relX, relY);
    });
});
</script>
        </main>

        <footer class="footer">
            <div class="content has-text-centered">
                <p>
                    <strong>Mazebert TD</strong> by Andreas Hager.<br/>
                    <a href="https://mazebert.com/privacy-policy/">Privacy</a>. <a href="https://mazebert.com/legal-notice/">Legal notice</a>.
                </p>
            </div>
        </footer>

        <script>
            $(document).ready(function() {
                $('.nav-mobile').click(function(){
                    $('#nav-icon').toggleClass('open');
                    $('.nav-menu').toggleClass('open');
                });
            });
        </script>

    </body>
</html>

